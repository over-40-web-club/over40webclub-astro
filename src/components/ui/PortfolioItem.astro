---
import OptimizedImage from './OptimizedImage.astro';
import Icon from './Icon.astro';

export interface Props {
  imageFileName: string;
  imageFileNameDetail?: string;
  header: string;
  subheader?: string;
  content: string;
  extraInfo?: string[];
}

const {
  imageFileName,
  imageFileNameDetail,
  header,
  subheader,
  content,
  extraInfo,
} = Astro.props;

// Generate unique ID for modal
const modalId = `portfolio-modal-${header.replace(/\s+/g, '-').toLowerCase()}`;
---

<div class='col-md-4 col-sm-6 portfolio-item'>
  <a
    class='portfolio-link'
    data-bs-toggle='modal'
    data-bs-target={`#${modalId}`}
    href={`#${modalId}`}
  >
    <OptimizedImage
      src={imageFileName}
      alt={header}
      class='img-fluid'
      width={400}
      height={300}
    />
    <div class='portfolio-hover'>
      <div class='portfolio-hover-content'>
        <Icon name='plus' size='2x' />
      </div>
    </div>
  </a>
  <div class='portfolio-caption'>
    <h4>{header}</h4>
    {subheader && <p class='text-muted'>{subheader}</p>}
  </div>
</div>

<!-- Portfolio Modal -->
<div
  class='modal fade'
  id={modalId}
  tabindex='-1'
  aria-labelledby={`${modalId}-label`}
  aria-hidden='true'
>
  <div class='modal-dialog modal-lg modal-dialog-centered'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title' id={`${modalId}-label`}>{header}</h5>
        <button
          type='button'
          class='btn-close'
          data-bs-dismiss='modal'
          aria-label='Close'></button>
      </div>
      <div class='modal-body text-center'>
        {subheader && <p class='item-intro text-muted'>{subheader}</p>}
        <OptimizedImage
          src={imageFileNameDetail || imageFileName}
          alt={header}
          class='img-fluid d-block mx-auto mb-3'
          width={600}
          height={400}
        />
        <div class='portfolio-content' set:html={content} />
        {
          extraInfo && extraInfo.length > 0 && (
            <div class='extra-info mt-3'>
              <ul class='list-unstyled'>
                {extraInfo.map((info) => (
                  <li>{info}</li>
                ))}
              </ul>
            </div>
          )
        }
      </div>
      <div class='modal-footer justify-content-center'>
        <button type='button' class='btn btn-primary' data-bs-dismiss='modal'>
          <Icon name='times' />
          &nbsp; Close
        </button>
      </div>
    </div>
  </div>
</div>

<style lang='scss'>
  @import '../../styles/global.scss';

  .portfolio-item {
    right: 0;
    margin: 0 0 15px;

    .portfolio-link {
      position: relative;
      display: block;
      max-width: 400px;
      margin: 0 auto;
      cursor: pointer;
      text-decoration: none;

      .portfolio-hover {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
        transition: all ease 0.5s;
        opacity: 0;
        background: rgba($primary, 0.9);

        &:hover {
          opacity: 1;
        }

        .portfolio-hover-content {
          font-size: 20px;
          position: absolute;
          top: 50%;
          width: 100%;
          height: 20px;
          margin-top: -12px;
          text-align: center;
          color: white;

          :global(svg) {
            margin-top: -12px;
          }

          h3,
          h4 {
            margin: 0;
          }
        }
      }
    }

    .portfolio-caption {
      max-width: 400px;
      margin: 0 auto;
      padding: 25px;
      text-align: center;
      background-color: $white;

      h4 {
        margin: 0;
        text-transform: none;
      }

      p {
        font-size: 16px;
        font-style: italic;
        margin: 0;
        @include serif-font;
      }
    }
  }

  .portfolio-content {
    text-align: left;

    :global(p) {
      margin-bottom: 1rem;
    }

    :global(a) {
      color: $primary;
      text-decoration: none;

      &:hover {
        text-decoration: underline;
      }
    }
  }

  .extra-info {
    text-align: left;
    background-color: $gray-100;
    padding: 1rem;
    border-radius: 0.375rem;

    ul {
      margin: 0;
    }

    li {
      padding: 0.25rem 0;
      font-size: 0.9rem;
    }
  }

  @media (min-width: 767px) {
    .portfolio-item {
      margin: 0 0 30px;
    }
  }
</style>
